<!-- public/auth/register.html -->
<!doctype html>
<meta charset="utf-8">
<title>Register</title>
<link rel="stylesheet" href="/public/styles.css">

<style>
  .alert{padding:10px;border-radius:8px;margin:12px 0;font-size:14px;line-height:1.4}
  .alert.ok{background:#e8f5e9;border:1px solid #a5d6a7}
  .alert.fail{background:#ffebee;border:1px solid #ef9a9a}
  .field{display:block;margin:8px 0}
  .row{display:flex;align-items:center;gap:6px}
</style>

<h1>Register</h1>

<div id="alert" class="alert" style="display:none"></div>

<form method="post" action="/auth/register">
  <label class="field">Username <input name="username" required></label>
  <label class="field">Email <input name="email" type="email" required></label>
  <label class="field">
    Password
    <div class="row">
      <input id="regPassword" name="password" type="password" required>
      <button type="button" id="toggleRegPass" title="Tahan mouse untuk melihat password">👁️</button>
    </div>
  </label>
  <button>Sign Up</button>
</form>

<p>Sudah punya akun? <a href="/auth/login">Login</a></p>

<script>
/* Toggle password */
const regPass = document.getElementById('regPassword');
const toggleRegPass = document.getElementById('toggleRegPass');
toggleRegPass.addEventListener('mousedown', () => { regPass.type = 'text'; toggleRegPass.textContent = '🙈'; });
toggleRegPass.addEventListener('mouseup',   () => { regPass.type = 'password'; toggleRegPass.textContent = '👁️'; });
toggleRegPass.addEventListener('mouseleave',() => { regPass.type = 'password'; toggleRegPass.textContent = '👁️'; });

/* Alert status & reason */
(function () {
  const box = document.getElementById('alert');
  const p = new URLSearchParams(location.search);
  const status = p.get('status');
  const reason = p.get('reason');

  if (!status) return;

  const map = {
    missing_field: 'Lengkapi semua field.',
    invalid_email: 'Format email tidak valid.',
    weak_password: 'Password terlalu lemah.',
    email_taken: 'Email sudah terdaftar.',
    server_error: 'Terjadi masalah di server. Coba lagi.'
  };

  let msg = status === 'ok'
    ? 'Registrasi berhasil. Silakan login.'
    : (map[reason] || `Registrasi gagal. (${reason || 'unknown'})`);

  box.textContent = msg;
  box.classList.add(status === 'ok' ? 'ok' : 'fail');
  box.style.display = 'block';
})();
</script>

