cd /home/kukuhtw/rust/ppv_stream
make db-up
make wait-db
make migrate
make build      # (build online sqlx)
make run-all
make seed

# buka http://localhost:8080/


make checkx402 NET=megaTestnet
make checkx402 mainnet

make estimatex402 NET=megaTestnet
make estimatex402 NET=polygonMainnet

make deployx402 NET=megaTestnet
make deployx402-mainnet

kukuhtw@KukuhTW-Lenovo:~/rust/ppv_stream$ make deployx402 NET=megaTestnet

==> Deploy X402Splitter ke network: megaTestnet
Downloading compiler 0.8.20
Compiled 1 Solidity file successfully (evm target: paris).
==============================================
ğŸš€ Deploying X402Splitter...
Network: megaTestnet
Chain ID: 6342
Admin Wallet: 0xB7256FB6fe96b8aDB4B4280E459fBED02C8db6f0
==============================================
X402Splitter deployed at: 0xa16bcF1D0Fd77A36ED4e2e0aC73fD36d5c7B3c96
==> Kontrak ter-deploy di: 0xa16bcF1D0Fd77A36ED4e2e0aC73fD36d5c7B3c96
âœ… Disimpan ke .env: X402_CONTRACT_ADDRESS=0xa16bcF1D0Fd77A36ED4e2e0aC73fD36d5c7B3c96
kukuhtw@KukuhTW-Lenovo:~/rust/ppv_stream$




curl -X POST https://carrot.megaeth.com/rpc \
  -H "Content-Type: application/json" \
  -d '{"jsonrpc":"2.0","method":"eth_getCode","params":["0xa16bcF1D0Fd77A36ED4e2e0aC73fD36d5c7B3c96","latest"],"id":1}'


make adminer-up  
kukuhtw@KukuhTW-Lenovo:~/rust/ppv_stream$ tree
.
â”œâ”€â”€ Cargo.lock
â”œâ”€â”€ Cargo.toml
â”œâ”€â”€ Dockerfile
â”œâ”€â”€ Makefile
â”œâ”€â”€ README.md
â”œâ”€â”€ a
â”œâ”€â”€ contracts
â”‚Â Â  â”œâ”€â”€ Dockerfile
â”‚Â Â  â”œâ”€â”€ contracts
â”‚Â Â  â”‚Â Â  â””â”€â”€ X402Splitter.sol
â”‚Â Â  â”œâ”€â”€ guidance_smartcontract_deployment
â”‚Â Â  â”œâ”€â”€ hardhat.config.js
â”‚Â Â  â”œâ”€â”€ package.json
â”‚Â Â  â””â”€â”€ scripts
â”‚Â Â      â”œâ”€â”€ deploy_x402.js
â”‚Â Â      â””â”€â”€ estimate_gas_cost.js
â”œâ”€â”€ docker-compose.yml
â”œâ”€â”€ migrations
â”‚Â Â  â”œâ”€â”€ 013_tokens.sql
â”‚Â Â  â”œâ”€â”€ 014_x402_invoice.sql
â”‚Â Â  â”œâ”€â”€ 015_users_wallet_chain.sql
â”‚Â Â  â”œâ”€â”€ 016_purchases_fk_video.sql
â”‚Â Â  â””â”€â”€ 017_allowlist_idx_username.sql
â”œâ”€â”€ public
â”‚Â Â  â”œâ”€â”€ admin
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ dashboard.html
â”‚Â Â  â”‚Â Â  â””â”€â”€ login.html
â”‚Â Â  â”œâ”€â”€ auth
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ forgot_password.html
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ login.html
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ register.html
â”‚Â Â  â”‚Â Â  â””â”€â”€ reset_password.html
â”‚Â Â  â”œâ”€â”€ browse.html
â”‚Â Â  â”œâ”€â”€ dashboard.html
â”‚Â Â  â”œâ”€â”€ index.html
â”‚Â Â  â”œâ”€â”€ styles.css
â”‚Â Â  â””â”€â”€ watch.html
â”œâ”€â”€ sql
â”‚Â Â  â”œâ”€â”€ 001_init.sql
â”‚Â Â  â”œâ”€â”€ 002_admins.sql
â”‚Â Â  â”œâ”€â”€ 003_password_resets.sql
â”‚Â Â  â”œâ”€â”€ 004_sessions.sql
â”‚Â Â  â”œâ”€â”€ 005_allowlist.sql
â”‚Â Â  â”œâ”€â”€ 006_indexes.sql
â”‚Â Â  â”œâ”€â”€ 007_perf_and_fk.sql
â”‚Â Â  â”œâ”€â”€ 008_price_cents_bigint.sql
â”‚Â Â  â”œâ”€â”€ 009_users_username_unique.sql
â”‚Â Â  â”œâ”€â”€ 010_videos_hls.sql
â”‚Â Â  â”œâ”€â”€ 011_videos_description.sql
â”‚Â Â  â””â”€â”€ 012_user_profile.sql
â””â”€â”€ src
    â”œâ”€â”€ a
    â”œâ”€â”€ auth.rs
    â”œâ”€â”€ bin
    â”‚Â Â  â””â”€â”€ seed_dummy.rs
    â”œâ”€â”€ bootstrap.rs
    â”œâ”€â”€ config.rs
    â”œâ”€â”€ db.rs
    â”œâ”€â”€ email.rs
    â”œâ”€â”€ ffmpeg.rs
    â”œâ”€â”€ handlers
    â”‚Â Â  â”œâ”€â”€ New folder
    â”‚Â Â  â”œâ”€â”€ admin.rs
    â”‚Â Â  â”œâ”€â”€ auth_admin.rs
    â”‚Â Â  â”œâ”€â”€ auth_user.rs
    â”‚Â Â  â”œâ”€â”€ kurs.rs
    â”‚Â Â  â”œâ”€â”€ me.rs
    â”‚Â Â  â”œâ”€â”€ mod.rs
    â”‚Â Â  â”œâ”€â”€ pages.rs
    â”‚Â Â  â”œâ”€â”€ password.rs
    â”‚Â Â  â”œâ”€â”€ pay.rs
    â”‚Â Â  â”œâ”€â”€ setup.rs
    â”‚Â Â  â”œâ”€â”€ stream.rs
    â”‚Â Â  â”œâ”€â”€ upload.rs
    â”‚Â Â  â”œâ”€â”€ users.rs
    â”‚Â Â  â””â”€â”€ video.rs
    â”œâ”€â”€ hls.rs
    â”œâ”€â”€ main.rs
    â”œâ”€â”€ middleware.rs
    â”œâ”€â”€ models.rs
    â”œâ”€â”€ schema.sql
    â”œâ”€â”€ sessions.rs
    â”œâ”€â”€ token.rs
    â”œâ”€â”€ util.rs
    â”œâ”€â”€ validators.rs
    â””â”€â”€ worker.rs

13 directories, 74 files
kukuhtw@KukuhTW-Lenovo:~/rust/ppv_stream$



â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ User Browser  â”‚
â”‚ (HTML + JS)   â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ HTTP
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Rust Backend (Axum)   â”‚
â”‚  - Auth (user/admin)  â”‚
â”‚  - Upload MP4         â”‚
â”‚  - Allowlist / Buy     â”‚
â”‚  - Request HLS Token  â”‚
â”‚  - Serve HLS Segments â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ SQLite DB    â”‚
   â”‚ (users,      â”‚
   â”‚  videos,     â”‚
   â”‚  purchases,  â”‚
   â”‚  allowlist)  â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ File Storage â”‚
   â”‚  - /storage/ â”‚
   â”‚  - /hls/     â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
# dari root project (ada Dockerfile & docker-compose.yaml)
docker build -t ppv_stream:dev .
docker images | grep ppv_stream      # pastikan terlihat ppv_stream   dev

docker compose up -d db app
docker compose logs -f app

docker build -t ppv_stream:dev .
docker compose up -d app db
docker compose logs -f app


find . -type f -name "*:Zone.Identifier" -exec rm -f {} +


docker system prune -af --volumes
cargo clean
rm -rf target
rm -rf data/ppv.db

docker compose up -d db
docker build --no-cache \
  --add-host=host.docker.internal:host-gateway \
  --build-arg DATABASE_URL=postgres://ppv:secret@host.docker.internal:5432/ppv_stream \
  --build-arg BUILD_REV=$(date +%s) \
  -t ppv_stream:dev .


ADMIN_BOOTSTRAP_EMAIL=admin@example.com
ADMIN_BOOTSTRAP_PASSWORD=ChangeMe123!


docker exec -it ppv_stream_db psql -U ppv -d ppv_stream -c \
"SELECT email, is_admin FROM users;"


| No | Username   | Email                                           | Password (plain) |
| -- | ---------- | ----------------------------------------------- | ---------------- |
| 1  | **user01** | [user01@example.com](mailto:user01@example.com) | `Passw0rd01!`    |
| 2  | **user02** | [user02@example.com](mailto:user02@example.com) | `Passw0rd02!`    |
| 3  | **user03** | [user03@example.com](mailto:user03@example.com) | `Passw0rd03!`    |
| 4  | **user04** | [user04@example.com](mailto:user04@example.com) | `Passw0rd04!`    |
| 5  | **user05** | [user05@example.com](mailto:user05@example.com) | `Passw0rd05!`    |
| 6  | **user06** | [user06@example.com](mailto:user06@example.com) | `Passw0rd06!`    |
| 7  | **user07** | [user07@example.com](mailto:user07@example.com) | `Passw0rd07!`    |
| 8  | **user08** | [user08@example.com](mailto:user08@example.com) | `Passw0rd08!`    |
| 9  | **user09** | [user09@example.com](mailto:user09@example.com) | `Passw0rd09!`    |
| 10 | **user10** | [user10@example.com](mailto:user10@example.com) | `Passw0rd10!`    |

